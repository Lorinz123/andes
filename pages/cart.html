<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/style/cart.css">
    <title>My Cart</title>
</head>
<body>
<header>
<nav class="navbar">
    <div class="navdiv">
        <div class="logo"><a href="../index.php"><img src="../assets/image/logo.png" alt="logo"></a>
        <a href="../index.php"><p>FLOWER PUFF</p></a>
        </div>
        <ul>
          <li><a href="../index.php">Home</a></li>
          <li><a href="./shop.php">Shop</a></li>
          <li><a href="./about.php">About</a></li>
        </ul>
    </div>
</nav>
</header>

  <main>
    <h1>My Cart</h1>
    <button class="back-btn" onclick="history.back()">Back</button>

    <div class="cart-table">
      <div class="cart-header">
        <span>Product</span>
        <span>Price</span>
        <span>Quantity</span>
        <span>Total</span>
      </div>
      <div id="cart-items"></div>
    </div>

    <div class="subtotal">
      <p>Subtotal: <span id="subtotal">₱0.00</span></p>
      <a href="../pages/checkout.html">
      <button id="checkout-btn">Proceed to checkout</button>
      </a>
      <div id="cartMessage" style="color:#b00020;font-weight:600;margin-top:8px;display:none;"></div>
    </div>
  </main>

  <footer>
    Copyrights ©2025. Flower Puff’s Management. All Rights Reserved.
  </footer>

  <script src="cart.js"></script>
  <script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];

function renderCart() {
  const container = document.getElementById("cart-items");
  const subtotalEl = document.getElementById("subtotal");
  container.innerHTML = "";

  let subtotal = 0;

  cart.forEach((item, index) => {
    const total = item.price * item.quantity;
    subtotal += total;

    const cartItem = document.createElement("div");
    cartItem.classList.add("cart-item");

    cartItem.innerHTML = `
      <div><img src="${item.image}" alt="${item.name}"><p>${item.name}</p></div>
      <div>₱${item.price.toLocaleString()}</div>
      <div>
        <button class="quantity-btn" onclick="changeQty(${index}, -1)">-</button>
        ${item.quantity}
        <button class="quantity-btn" onclick="changeQty(${index}, 1)">+</button>
      </div>
      <div>₱${total.toLocaleString()}</div>
    `;

    container.appendChild(cartItem);
  });

  subtotalEl.textContent = `₱${subtotal.toLocaleString()}`;
}

function changeQty(index, amount) {
  cart[index].quantity += amount;
  if (cart[index].quantity <= 0) cart.splice(index, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

renderCart();

// Prevent proceeding to checkout when cart is empty — show inline message
document.addEventListener('DOMContentLoaded', function() {
  const checkoutLink = document.querySelector('.subtotal a');
  const cartMessage = document.getElementById('cartMessage');
  function showCartMessage(msg) {
    if (!cartMessage) return;
    cartMessage.textContent = msg;
    cartMessage.style.display = 'block';
    window.scrollTo({ top: cartMessage.getBoundingClientRect().top + window.scrollY - 80, behavior: 'smooth' });
    setTimeout(() => { cartMessage.style.display = 'none'; }, 5000);
  }

  if (checkoutLink) {
    checkoutLink.addEventListener('click', function(e) {
      const currentCart = JSON.parse(localStorage.getItem('cart')) || [];
      if (!currentCart || currentCart.length === 0) {
        e.preventDefault();
        showCartMessage('Your cart is empty. Add items before proceeding to checkout.');
      }
    });
  }
});
</script>
</body>
</html>
